{"ast":null,"code":"/**\n * Copyright © INOVUA TRADING.\n *\n * This source code is licensed under the Commercial License found in the\n * LICENSE file in the root directory of this source tree.\n */\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.updateBucketSummaries = exports.getDefaultGroupSummaryValue = exports.flatten = exports.default = void 0;\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      (0, _defineProperty2.default)(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nvar get = function get(item, field) {\n  return item[field];\n};\n\nvar defaultStringify = function defaultStringify(obj) {\n  var type = (0, _typeof2.default)(obj);\n  return type == 'string' || type === 'number' || type === 'boolean' ? \"\".concat(obj) : JSON.stringify(obj);\n};\n\nvar getShowSummaryRow = function getShowSummaryRow(showGroupSummaryRow, groupData, pivot) {\n  if (!showGroupSummaryRow || !groupData || pivot) {\n    return false;\n  }\n\n  if (typeof showGroupSummaryRow === 'function') {\n    showGroupSummaryRow = showGroupSummaryRow(groupData);\n  }\n\n  if (showGroupSummaryRow === true) {\n    showGroupSummaryRow = 'end';\n  }\n\n  if (!showGroupSummaryRow) {\n    showGroupSummaryRow = false;\n  }\n\n  return showGroupSummaryRow;\n};\n\nvar completeBucketSummaries = function completeBucketSummaries(bucket, _ref) {\n  var groupSummaryReducer = _ref.groupSummaryReducer,\n      groupColumnSummaryReducers = _ref.groupColumnSummaryReducers,\n      pivotColumnSummaryReducers = _ref.pivotColumnSummaryReducers;\n\n  if (groupSummaryReducer && groupSummaryReducer.complete) {\n    bucket.groupSummary = groupSummaryReducer.complete(bucket.groupSummary, bucket.array);\n  }\n\n  if (groupColumnSummaryReducers) {\n    bucket.groupColumnSummary = Object.keys(groupColumnSummaryReducers).reduce(function (acc, key) {\n      var value = acc[key];\n      var reducer = groupColumnSummaryReducers[key];\n\n      if (reducer.complete) {\n        acc[key] = reducer.complete(value, bucket.array);\n      }\n\n      return acc;\n    }, bucket.groupColumnSummary);\n\n    if (bucket.pivotSummary !== null) {\n      completePivotBucketSummaries(bucket, {\n        groupColumnSummaryReducers: groupColumnSummaryReducers,\n        pivotColumnSummaryReducers: pivotColumnSummaryReducers\n      });\n    }\n  }\n\n  return bucket;\n};\n\nvar completeGroupColumnSummaryReducers = function completeGroupColumnSummaryReducers(target, array, groupColumnSummaryReducers) {\n  if (!target || !groupColumnSummaryReducers) {\n    return null;\n  }\n\n  return Object.keys(groupColumnSummaryReducers).reduce(function (acc, colId) {\n    var reducer = groupColumnSummaryReducers[colId];\n\n    if (reducer.complete) {\n      acc[colId] = reducer.complete(acc[colId], array);\n    }\n\n    return acc;\n  }, target);\n};\n\nvar completePivotBucketSummaries = function completePivotBucketSummaries(pivotSummaryBucket, _ref2) {\n  var groupColumnSummaryReducers = _ref2.groupColumnSummaryReducers,\n      pivotColumnSummaryReducers = _ref2.pivotColumnSummaryReducers;\n\n  if (!pivotSummaryBucket.pivotSummary) {\n    return;\n  }\n\n  Object.keys(pivotSummaryBucket.pivotSummary).forEach(function (groupName) {\n    var pivotBucket = pivotSummaryBucket.pivotSummary[groupName];\n    pivotBucket.values = completeGroupColumnSummaryReducers(pivotBucket.values, pivotBucket.array, groupColumnSummaryReducers);\n    completePivotBucketSummaries(pivotBucket, {\n      groupColumnSummaryReducers: groupColumnSummaryReducers,\n      pivotColumnSummaryReducers: pivotColumnSummaryReducers\n    });\n\n    if (pivotBucket.pivotColumnSummary && pivotColumnSummaryReducers && pivotColumnSummaryReducers[pivotBucket.field]) {\n      var pivotColumnSummaryReducer = pivotColumnSummaryReducers[pivotBucket.field];\n\n      if (pivotColumnSummaryReducer.complete) {\n        pivotBucket.pivotColumnSummary[pivotBucket.field] = pivotColumnSummaryReducer.complete(pivotBucket.pivotColumnSummary[pivotBucket.field], pivotBucket.array);\n      }\n    }\n  });\n};\n\nvar createGroupItem = function createGroupItem(key, bucket) {\n  return {\n    __group: true,\n    leaf: !bucket.data,\n    value: key,\n    depth: bucket.depth,\n    groupSummary: bucket.groupSummary,\n    groupColumnSummary: bucket.groupColumnSummary,\n    pivotSummary: bucket.pivotSummary,\n    keyPath: bucket.keyPath,\n    fieldPath: bucket.fieldPath\n  };\n};\n\nvar flatten = function flatten(bucket, _ref3) {\n  var pivot = _ref3.pivot,\n      groupSummaryReducer = _ref3.groupSummaryReducer,\n      groupColumnSummaryReducers = _ref3.groupColumnSummaryReducers,\n      pivotColumnSummaryReducers = _ref3.pivotColumnSummaryReducers,\n      isCollapsed = _ref3.isCollapsed,\n      showGroupSummaryRow = _ref3.showGroupSummaryRow;\n  var data = [];\n  var indexesInGroups = [];\n  var groupCounts = [];\n  completeBucketSummaries(bucket, {\n    groupSummaryReducer: groupSummaryReducer,\n    groupColumnSummaryReducers: groupColumnSummaryReducers,\n    pivotColumnSummaryReducers: pivotColumnSummaryReducers\n  });\n  var shouldInclude = true;\n  var showSummaryRow;\n  var summaryGroupItem;\n\n  if (!bucket.data) {\n    var groupItem = createGroupItem(bucket.key, bucket);\n    data = [groupItem];\n    indexesInGroups = [-1];\n    groupCounts = [-1];\n    shouldInclude = !pivot;\n\n    if (isCollapsed && isCollapsed(groupItem)) {\n      shouldInclude = false;\n    }\n\n    if (shouldInclude) {\n      showSummaryRow = getShowSummaryRow(showGroupSummaryRow, groupItem, pivot);\n      summaryGroupItem = showSummaryRow ? _objectSpread(_objectSpread({}, groupItem.groupColumnSummary), {}, {\n        __parentGroup: groupItem,\n        __summary: showSummaryRow\n      }) : null;\n      var indexesInGroupsOffset = 0;\n\n      if (showSummaryRow === 'start') {\n        data.push(summaryGroupItem);\n        groupCounts.push(-1);\n        indexesInGroups.push(-1);\n      }\n\n      data = data.concat(bucket.array);\n      indexesInGroups = indexesInGroups.concat(bucket.array.map(function (_, index) {\n        return index + indexesInGroupsOffset;\n      }));\n      groupCounts = groupCounts.concat(bucket.array.map(function (_) {\n        return bucket.array.length;\n      }));\n\n      if (showSummaryRow === 'end') {\n        data.push(summaryGroupItem);\n        indexesInGroups.push(-1);\n        groupCounts.push(-1);\n      }\n    }\n  } else {\n    var _groupItem = bucket.key != null ? createGroupItem(bucket.key, bucket) : null;\n\n    data = _groupItem ? [_groupItem] : [];\n    indexesInGroups = _groupItem ? [-1] : [];\n    groupCounts = _groupItem ? [-1] : [];\n\n    if (_groupItem && isCollapsed && isCollapsed(_groupItem)) {\n      shouldInclude = false;\n    }\n\n    if (shouldInclude) {\n      showSummaryRow = getShowSummaryRow(showGroupSummaryRow, _groupItem, pivot);\n      summaryGroupItem = showSummaryRow ? _objectSpread(_objectSpread({}, _groupItem.groupColumnSummary), {}, {\n        __parentGroup: _groupItem,\n        __summary: showSummaryRow\n      }) : null;\n\n      if (showSummaryRow === 'start') {\n        data.push(summaryGroupItem);\n        indexesInGroups.push(-1);\n        groupCounts.push(-1);\n      }\n\n      data = bucket.order.reduce(function (data, key) {\n        var childBucket = bucket.data[key];\n        var result = flatten(childBucket, {\n          pivot: pivot,\n          isCollapsed: isCollapsed,\n          showGroupSummaryRow: showGroupSummaryRow,\n          groupColumnSummaryReducers: groupColumnSummaryReducers,\n          groupSummaryReducer: groupSummaryReducer,\n          pivotColumnSummaryReducers: pivotColumnSummaryReducers\n        });\n        indexesInGroups = indexesInGroups.concat(result.indexesInGroups);\n        groupCounts = groupCounts.concat(result.groupCounts);\n        return data.concat(result.data);\n      }, data);\n\n      if (showSummaryRow === 'end') {\n        data.push(summaryGroupItem);\n        indexesInGroups.push(-1);\n        groupCounts.push(-1);\n      }\n    }\n  }\n\n  return {\n    indexesInGroups: indexesInGroups,\n    groupCounts: groupCounts,\n    bucket: bucket,\n    data: data\n  };\n};\n\nexports.flatten = flatten;\n\nvar buildDataBucket = function buildDataBucket(_ref4) {\n  var field = _ref4.field,\n      key = _ref4.key,\n      parent = _ref4.parent,\n      groupSummaryReducer = _ref4.groupSummaryReducer,\n      groupColumnSummaryReducers = _ref4.groupColumnSummaryReducers,\n      pivotColumnSummaryReducers = _ref4.pivotColumnSummaryReducers;\n  return {\n    key: key,\n    field: field,\n    fieldPath: parent && field ? [].concat((0, _toConsumableArray2.default)(parent.fieldPath), [field]) : [],\n    keyPath: parent && key ? [].concat((0, _toConsumableArray2.default)(parent.keyPath), [key]) : [],\n    order: [],\n    array: [],\n    data: null,\n    depth: parent ? parent.depth + 1 : 0,\n    groupSummary: groupSummaryReducer ? groupSummaryReducer.initialValue : null,\n    groupColumnSummary: getDefaultGroupSummaryValue(groupColumnSummaryReducers),\n    pivotColumnSummary: getDefaultGroupSummaryValue(pivotColumnSummaryReducers),\n    pivotSummary: null\n  };\n};\n\nvar groupAndPivot = function groupAndPivot(data, _ref5) {\n  var groupBy = _ref5.groupBy,\n      pivot = _ref5.pivot,\n      columnsMap = _ref5.columnsMap,\n      _ref5$stringify = _ref5.stringify,\n      stringify = _ref5$stringify === void 0 ? defaultStringify : _ref5$stringify,\n      groupSummaryReducer = _ref5.groupSummaryReducer,\n      groupColumnSummaryReducers = _ref5.groupColumnSummaryReducers,\n      pivotColumnSummaryReducers = _ref5.pivotColumnSummaryReducers;\n  var masterBucket = buildDataBucket({\n    field: null,\n    parent: null,\n    key: null,\n    groupSummaryReducer: groupSummaryReducer,\n    groupColumnSummaryReducers: groupColumnSummaryReducers,\n    pivotColumnSummaryReducers: pivotColumnSummaryReducers\n  });\n\n  if (pivot && pivot.length) {\n    masterBucket.pivotUniqueValuesPerColumn = {\n      field: null,\n      values: null\n    };\n  }\n\n  var onItem = function onItem(item) {\n    var rootBucket = masterBucket;\n    updateBucketSummaries(rootBucket, item, {\n      groupSummaryReducer: groupSummaryReducer,\n      groupColumnSummaryReducers: groupColumnSummaryReducers,\n      columnsMap: columnsMap\n    });\n    groupBy.forEach(function (field) {\n      var fieldValue = get(item, field);\n      var toString = columnsMap[field] ? columnsMap[field].groupToString || stringify : stringify;\n      var stringKey = toString(fieldValue, {\n        data: item,\n        field: field\n      });\n\n      if (!rootBucket.data) {\n        rootBucket.data = {};\n      }\n\n      var currentBucket = rootBucket.data[stringKey];\n\n      if (!currentBucket) {\n        currentBucket = rootBucket.data[stringKey] = buildDataBucket({\n          field: field,\n          key: stringKey,\n          parent: rootBucket,\n          groupSummaryReducer: groupSummaryReducer,\n          groupColumnSummaryReducers: groupColumnSummaryReducers\n        });\n        rootBucket.order.push(stringKey);\n      }\n\n      currentBucket.array.push(item);\n      updateBucketSummaries(currentBucket, item, {\n        groupSummaryReducer: groupSummaryReducer,\n        groupColumnSummaryReducers: groupColumnSummaryReducers,\n        columnsMap: columnsMap\n      });\n\n      if (pivot && pivot.length) {\n        var pivotBucketOwner = currentBucket;\n        var uniqueValuesRoot = masterBucket.pivotUniqueValuesPerColumn;\n        pivot.forEach(function (field) {\n          field = typeof field === 'string' ? field : field.name;\n          var fieldValue = get(item, field);\n          var col = columnsMap[field];\n          var toString = col ? col.pivotToString || col.groupToString || stringify : stringify;\n          var stringKey = toString(fieldValue, {\n            data: item,\n            field: field\n          });\n\n          if (!pivotBucketOwner.pivotSummary) {\n            pivotBucketOwner.pivotSummary = {};\n          }\n\n          if (!pivotBucketOwner.pivotColumnSummary) {\n            pivotBucketOwner.pivotColumnSummary = {};\n          }\n\n          var currentPivotSummaryBucket = pivotBucketOwner.pivotSummary;\n          pivotBucketOwner = updateBucketPivotSummary(currentPivotSummaryBucket, item, {\n            field: field,\n            groupName: stringKey,\n            groupColumnSummaryReducers: groupColumnSummaryReducers,\n            pivotColumnSummaryReducers: pivotColumnSummaryReducers ? (0, _defineProperty2.default)({}, field, pivotColumnSummaryReducers[field]) : undefined,\n            columnsMap: columnsMap\n          });\n\n          if (!uniqueValuesRoot.field) {\n            uniqueValuesRoot.field = field;\n            uniqueValuesRoot.values = {};\n          }\n\n          if (!uniqueValuesRoot.values[stringKey]) {\n            uniqueValuesRoot.values[stringKey] = {\n              field: null,\n              values: null\n            };\n          }\n\n          uniqueValuesRoot = uniqueValuesRoot.values[stringKey];\n        });\n      }\n\n      rootBucket = currentBucket;\n    });\n  };\n\n  data.forEach(onItem);\n  return masterBucket;\n};\n\nvar updateBucketSummaries = function updateBucketSummaries(currentBucket, item, _ref7) {\n  var groupSummaryReducer = _ref7.groupSummaryReducer,\n      groupColumnSummaryReducers = _ref7.groupColumnSummaryReducers,\n      columnsMap = _ref7.columnsMap;\n\n  if (groupSummaryReducer) {\n    currentBucket.groupSummary = groupSummaryReducer.reducer(currentBucket.groupSummary, item, item);\n  }\n\n  if (groupColumnSummaryReducers) {\n    currentBucket.groupColumnSummary = Object.keys(groupColumnSummaryReducers).reduce(function (columnSummaries, colId) {\n      var col = columnsMap[colId];\n      var value = col.name ? item[col.name] : item[colId];\n      columnSummaries[colId] = groupColumnSummaryReducers[colId].reducer(columnSummaries[colId], value, item);\n      return columnSummaries;\n    }, currentBucket.groupColumnSummary);\n  }\n};\n\nexports.updateBucketSummaries = updateBucketSummaries;\n\nvar updateBucketPivotSummary = function updateBucketPivotSummary(currentBucket, item, _ref8) {\n  var groupColumnSummaryReducers = _ref8.groupColumnSummaryReducers,\n      pivotColumnSummaryReducers = _ref8.pivotColumnSummaryReducers,\n      groupName = _ref8.groupName,\n      field = _ref8.field,\n      columnsMap = _ref8.columnsMap;\n  groupColumnSummaryReducers = groupColumnSummaryReducers || {};\n  pivotColumnSummaryReducers = pivotColumnSummaryReducers || {};\n\n  if (!currentBucket[groupName]) {\n    currentBucket[groupName] = {\n      array: [],\n      field: field,\n      values: getDefaultGroupSummaryValue(groupColumnSummaryReducers),\n      pivotColumnSummary: getDefaultGroupSummaryValue(pivotColumnSummaryReducers),\n      pivotSummary: null\n    };\n  }\n\n  currentBucket[groupName].array.push(item);\n  currentBucket[groupName].values = Object.keys(groupColumnSummaryReducers).reduce(function (columnSummaries, colId) {\n    var col = columnsMap[colId];\n    var value = col.name ? item[col.name] : item[colId];\n    columnSummaries[colId] = groupColumnSummaryReducers[colId].reducer(columnSummaries[colId], value, item);\n    return columnSummaries;\n  }, currentBucket[groupName].values);\n  currentBucket[groupName].pivotColumnSummary = Object.keys(pivotColumnSummaryReducers).reduce(function (pivotColumnSummaries, colId) {\n    if (pivotColumnSummaryReducers[colId]) {\n      pivotColumnSummaries[colId] = pivotColumnSummaryReducers[colId].reducer(pivotColumnSummaries[colId], groupName, item);\n    }\n\n    return pivotColumnSummaries;\n  }, currentBucket[groupName].pivotColumnSummary);\n  return currentBucket[groupName];\n};\n\nvar getDefaultGroupSummaryValue = function getDefaultGroupSummaryValue(groupColumnSummaryReducers) {\n  return groupColumnSummaryReducers ? Object.keys(groupColumnSummaryReducers).reduce(function (acc, key) {\n    if (groupColumnSummaryReducers[key]) {\n      acc[key] = groupColumnSummaryReducers[key].initialValue;\n    }\n\n    return acc;\n  }, {}) : null;\n};\n\nexports.getDefaultGroupSummaryValue = getDefaultGroupSummaryValue;\nvar _default = groupAndPivot;\nexports.default = _default;","map":{"version":3,"sources":["/Users/sungjaejoo/Desktop/리액트/인터로거/ILP-main/node_modules/@inovua/reactdatagrid-enterprise/plugins/group-and-pivot/groupAndPivot/index.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","updateBucketSummaries","getDefaultGroupSummaryValue","flatten","default","_toConsumableArray2","_defineProperty2","_typeof2","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","get","item","field","defaultStringify","obj","type","concat","JSON","stringify","getShowSummaryRow","showGroupSummaryRow","groupData","pivot","completeBucketSummaries","bucket","_ref","groupSummaryReducer","groupColumnSummaryReducers","pivotColumnSummaryReducers","complete","groupSummary","array","groupColumnSummary","reduce","acc","reducer","pivotSummary","completePivotBucketSummaries","completeGroupColumnSummaryReducers","colId","pivotSummaryBucket","_ref2","groupName","pivotBucket","values","pivotColumnSummary","pivotColumnSummaryReducer","createGroupItem","__group","leaf","data","depth","keyPath","fieldPath","_ref3","isCollapsed","indexesInGroups","groupCounts","shouldInclude","showSummaryRow","summaryGroupItem","groupItem","__parentGroup","__summary","indexesInGroupsOffset","map","_","index","_groupItem","order","childBucket","result","buildDataBucket","_ref4","parent","initialValue","groupAndPivot","_ref5","groupBy","columnsMap","_ref5$stringify","masterBucket","pivotUniqueValuesPerColumn","onItem","rootBucket","fieldValue","toString","groupToString","stringKey","currentBucket","pivotBucketOwner","uniqueValuesRoot","name","col","pivotToString","currentPivotSummaryBucket","updateBucketPivotSummary","undefined","_ref7","columnSummaries","_ref8","pivotColumnSummaries","_default"],"mappings":"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","sourcesContent":["/**\n * Copyright © INOVUA TRADING.\n *\n * This source code is licensed under the Commercial License found in the\n * LICENSE file in the root directory of this source tree.\n */\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.updateBucketSummaries = exports.getDefaultGroupSummaryValue = exports.flatten = exports.default = void 0;\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar get = function get(item, field) {\n  return item[field];\n};\n\nvar defaultStringify = function defaultStringify(obj) {\n  var type = (0, _typeof2.default)(obj);\n  return type == 'string' || type === 'number' || type === 'boolean' ? \"\".concat(obj) : JSON.stringify(obj);\n};\n\nvar getShowSummaryRow = function getShowSummaryRow(showGroupSummaryRow, groupData, pivot) {\n  if (!showGroupSummaryRow || !groupData || pivot) {\n    return false;\n  }\n\n  if (typeof showGroupSummaryRow === 'function') {\n    showGroupSummaryRow = showGroupSummaryRow(groupData);\n  }\n\n  if (showGroupSummaryRow === true) {\n    showGroupSummaryRow = 'end';\n  }\n\n  if (!showGroupSummaryRow) {\n    showGroupSummaryRow = false;\n  }\n\n  return showGroupSummaryRow;\n};\n\nvar completeBucketSummaries = function completeBucketSummaries(bucket, _ref) {\n  var groupSummaryReducer = _ref.groupSummaryReducer,\n      groupColumnSummaryReducers = _ref.groupColumnSummaryReducers,\n      pivotColumnSummaryReducers = _ref.pivotColumnSummaryReducers;\n\n  if (groupSummaryReducer && groupSummaryReducer.complete) {\n    bucket.groupSummary = groupSummaryReducer.complete(bucket.groupSummary, bucket.array);\n  }\n\n  if (groupColumnSummaryReducers) {\n    bucket.groupColumnSummary = Object.keys(groupColumnSummaryReducers).reduce(function (acc, key) {\n      var value = acc[key];\n      var reducer = groupColumnSummaryReducers[key];\n\n      if (reducer.complete) {\n        acc[key] = reducer.complete(value, bucket.array);\n      }\n\n      return acc;\n    }, bucket.groupColumnSummary);\n\n    if (bucket.pivotSummary !== null) {\n      completePivotBucketSummaries(bucket, {\n        groupColumnSummaryReducers: groupColumnSummaryReducers,\n        pivotColumnSummaryReducers: pivotColumnSummaryReducers\n      });\n    }\n  }\n\n  return bucket;\n};\n\nvar completeGroupColumnSummaryReducers = function completeGroupColumnSummaryReducers(target, array, groupColumnSummaryReducers) {\n  if (!target || !groupColumnSummaryReducers) {\n    return null;\n  }\n\n  return Object.keys(groupColumnSummaryReducers).reduce(function (acc, colId) {\n    var reducer = groupColumnSummaryReducers[colId];\n\n    if (reducer.complete) {\n      acc[colId] = reducer.complete(acc[colId], array);\n    }\n\n    return acc;\n  }, target);\n};\n\nvar completePivotBucketSummaries = function completePivotBucketSummaries(pivotSummaryBucket, _ref2) {\n  var groupColumnSummaryReducers = _ref2.groupColumnSummaryReducers,\n      pivotColumnSummaryReducers = _ref2.pivotColumnSummaryReducers;\n\n  if (!pivotSummaryBucket.pivotSummary) {\n    return;\n  }\n\n  Object.keys(pivotSummaryBucket.pivotSummary).forEach(function (groupName) {\n    var pivotBucket = pivotSummaryBucket.pivotSummary[groupName];\n    pivotBucket.values = completeGroupColumnSummaryReducers(pivotBucket.values, pivotBucket.array, groupColumnSummaryReducers);\n    completePivotBucketSummaries(pivotBucket, {\n      groupColumnSummaryReducers: groupColumnSummaryReducers,\n      pivotColumnSummaryReducers: pivotColumnSummaryReducers\n    });\n\n    if (pivotBucket.pivotColumnSummary && pivotColumnSummaryReducers && pivotColumnSummaryReducers[pivotBucket.field]) {\n      var pivotColumnSummaryReducer = pivotColumnSummaryReducers[pivotBucket.field];\n\n      if (pivotColumnSummaryReducer.complete) {\n        pivotBucket.pivotColumnSummary[pivotBucket.field] = pivotColumnSummaryReducer.complete(pivotBucket.pivotColumnSummary[pivotBucket.field], pivotBucket.array);\n      }\n    }\n  });\n};\n\nvar createGroupItem = function createGroupItem(key, bucket) {\n  return {\n    __group: true,\n    leaf: !bucket.data,\n    value: key,\n    depth: bucket.depth,\n    groupSummary: bucket.groupSummary,\n    groupColumnSummary: bucket.groupColumnSummary,\n    pivotSummary: bucket.pivotSummary,\n    keyPath: bucket.keyPath,\n    fieldPath: bucket.fieldPath\n  };\n};\n\nvar flatten = function flatten(bucket, _ref3) {\n  var pivot = _ref3.pivot,\n      groupSummaryReducer = _ref3.groupSummaryReducer,\n      groupColumnSummaryReducers = _ref3.groupColumnSummaryReducers,\n      pivotColumnSummaryReducers = _ref3.pivotColumnSummaryReducers,\n      isCollapsed = _ref3.isCollapsed,\n      showGroupSummaryRow = _ref3.showGroupSummaryRow;\n  var data = [];\n  var indexesInGroups = [];\n  var groupCounts = [];\n  completeBucketSummaries(bucket, {\n    groupSummaryReducer: groupSummaryReducer,\n    groupColumnSummaryReducers: groupColumnSummaryReducers,\n    pivotColumnSummaryReducers: pivotColumnSummaryReducers\n  });\n  var shouldInclude = true;\n  var showSummaryRow;\n  var summaryGroupItem;\n\n  if (!bucket.data) {\n    var groupItem = createGroupItem(bucket.key, bucket);\n    data = [groupItem];\n    indexesInGroups = [-1];\n    groupCounts = [-1];\n    shouldInclude = !pivot;\n\n    if (isCollapsed && isCollapsed(groupItem)) {\n      shouldInclude = false;\n    }\n\n    if (shouldInclude) {\n      showSummaryRow = getShowSummaryRow(showGroupSummaryRow, groupItem, pivot);\n      summaryGroupItem = showSummaryRow ? _objectSpread(_objectSpread({}, groupItem.groupColumnSummary), {}, {\n        __parentGroup: groupItem,\n        __summary: showSummaryRow\n      }) : null;\n      var indexesInGroupsOffset = 0;\n\n      if (showSummaryRow === 'start') {\n        data.push(summaryGroupItem);\n        groupCounts.push(-1);\n        indexesInGroups.push(-1);\n      }\n\n      data = data.concat(bucket.array);\n      indexesInGroups = indexesInGroups.concat(bucket.array.map(function (_, index) {\n        return index + indexesInGroupsOffset;\n      }));\n      groupCounts = groupCounts.concat(bucket.array.map(function (_) {\n        return bucket.array.length;\n      }));\n\n      if (showSummaryRow === 'end') {\n        data.push(summaryGroupItem);\n        indexesInGroups.push(-1);\n        groupCounts.push(-1);\n      }\n    }\n  } else {\n    var _groupItem = bucket.key != null ? createGroupItem(bucket.key, bucket) : null;\n\n    data = _groupItem ? [_groupItem] : [];\n    indexesInGroups = _groupItem ? [-1] : [];\n    groupCounts = _groupItem ? [-1] : [];\n\n    if (_groupItem && isCollapsed && isCollapsed(_groupItem)) {\n      shouldInclude = false;\n    }\n\n    if (shouldInclude) {\n      showSummaryRow = getShowSummaryRow(showGroupSummaryRow, _groupItem, pivot);\n      summaryGroupItem = showSummaryRow ? _objectSpread(_objectSpread({}, _groupItem.groupColumnSummary), {}, {\n        __parentGroup: _groupItem,\n        __summary: showSummaryRow\n      }) : null;\n\n      if (showSummaryRow === 'start') {\n        data.push(summaryGroupItem);\n        indexesInGroups.push(-1);\n        groupCounts.push(-1);\n      }\n\n      data = bucket.order.reduce(function (data, key) {\n        var childBucket = bucket.data[key];\n        var result = flatten(childBucket, {\n          pivot: pivot,\n          isCollapsed: isCollapsed,\n          showGroupSummaryRow: showGroupSummaryRow,\n          groupColumnSummaryReducers: groupColumnSummaryReducers,\n          groupSummaryReducer: groupSummaryReducer,\n          pivotColumnSummaryReducers: pivotColumnSummaryReducers\n        });\n        indexesInGroups = indexesInGroups.concat(result.indexesInGroups);\n        groupCounts = groupCounts.concat(result.groupCounts);\n        return data.concat(result.data);\n      }, data);\n\n      if (showSummaryRow === 'end') {\n        data.push(summaryGroupItem);\n        indexesInGroups.push(-1);\n        groupCounts.push(-1);\n      }\n    }\n  }\n\n  return {\n    indexesInGroups: indexesInGroups,\n    groupCounts: groupCounts,\n    bucket: bucket,\n    data: data\n  };\n};\n\nexports.flatten = flatten;\n\nvar buildDataBucket = function buildDataBucket(_ref4) {\n  var field = _ref4.field,\n      key = _ref4.key,\n      parent = _ref4.parent,\n      groupSummaryReducer = _ref4.groupSummaryReducer,\n      groupColumnSummaryReducers = _ref4.groupColumnSummaryReducers,\n      pivotColumnSummaryReducers = _ref4.pivotColumnSummaryReducers;\n  return {\n    key: key,\n    field: field,\n    fieldPath: parent && field ? [].concat((0, _toConsumableArray2.default)(parent.fieldPath), [field]) : [],\n    keyPath: parent && key ? [].concat((0, _toConsumableArray2.default)(parent.keyPath), [key]) : [],\n    order: [],\n    array: [],\n    data: null,\n    depth: parent ? parent.depth + 1 : 0,\n    groupSummary: groupSummaryReducer ? groupSummaryReducer.initialValue : null,\n    groupColumnSummary: getDefaultGroupSummaryValue(groupColumnSummaryReducers),\n    pivotColumnSummary: getDefaultGroupSummaryValue(pivotColumnSummaryReducers),\n    pivotSummary: null\n  };\n};\n\nvar groupAndPivot = function groupAndPivot(data, _ref5) {\n  var groupBy = _ref5.groupBy,\n      pivot = _ref5.pivot,\n      columnsMap = _ref5.columnsMap,\n      _ref5$stringify = _ref5.stringify,\n      stringify = _ref5$stringify === void 0 ? defaultStringify : _ref5$stringify,\n      groupSummaryReducer = _ref5.groupSummaryReducer,\n      groupColumnSummaryReducers = _ref5.groupColumnSummaryReducers,\n      pivotColumnSummaryReducers = _ref5.pivotColumnSummaryReducers;\n  var masterBucket = buildDataBucket({\n    field: null,\n    parent: null,\n    key: null,\n    groupSummaryReducer: groupSummaryReducer,\n    groupColumnSummaryReducers: groupColumnSummaryReducers,\n    pivotColumnSummaryReducers: pivotColumnSummaryReducers\n  });\n\n  if (pivot && pivot.length) {\n    masterBucket.pivotUniqueValuesPerColumn = {\n      field: null,\n      values: null\n    };\n  }\n\n  var onItem = function onItem(item) {\n    var rootBucket = masterBucket;\n    updateBucketSummaries(rootBucket, item, {\n      groupSummaryReducer: groupSummaryReducer,\n      groupColumnSummaryReducers: groupColumnSummaryReducers,\n      columnsMap: columnsMap\n    });\n    groupBy.forEach(function (field) {\n      var fieldValue = get(item, field);\n      var toString = columnsMap[field] ? columnsMap[field].groupToString || stringify : stringify;\n      var stringKey = toString(fieldValue, {\n        data: item,\n        field: field\n      });\n\n      if (!rootBucket.data) {\n        rootBucket.data = {};\n      }\n\n      var currentBucket = rootBucket.data[stringKey];\n\n      if (!currentBucket) {\n        currentBucket = rootBucket.data[stringKey] = buildDataBucket({\n          field: field,\n          key: stringKey,\n          parent: rootBucket,\n          groupSummaryReducer: groupSummaryReducer,\n          groupColumnSummaryReducers: groupColumnSummaryReducers\n        });\n        rootBucket.order.push(stringKey);\n      }\n\n      currentBucket.array.push(item);\n      updateBucketSummaries(currentBucket, item, {\n        groupSummaryReducer: groupSummaryReducer,\n        groupColumnSummaryReducers: groupColumnSummaryReducers,\n        columnsMap: columnsMap\n      });\n\n      if (pivot && pivot.length) {\n        var pivotBucketOwner = currentBucket;\n        var uniqueValuesRoot = masterBucket.pivotUniqueValuesPerColumn;\n        pivot.forEach(function (field) {\n          field = typeof field === 'string' ? field : field.name;\n          var fieldValue = get(item, field);\n          var col = columnsMap[field];\n          var toString = col ? col.pivotToString || col.groupToString || stringify : stringify;\n          var stringKey = toString(fieldValue, {\n            data: item,\n            field: field\n          });\n\n          if (!pivotBucketOwner.pivotSummary) {\n            pivotBucketOwner.pivotSummary = {};\n          }\n\n          if (!pivotBucketOwner.pivotColumnSummary) {\n            pivotBucketOwner.pivotColumnSummary = {};\n          }\n\n          var currentPivotSummaryBucket = pivotBucketOwner.pivotSummary;\n          pivotBucketOwner = updateBucketPivotSummary(currentPivotSummaryBucket, item, {\n            field: field,\n            groupName: stringKey,\n            groupColumnSummaryReducers: groupColumnSummaryReducers,\n            pivotColumnSummaryReducers: pivotColumnSummaryReducers ? (0, _defineProperty2.default)({}, field, pivotColumnSummaryReducers[field]) : undefined,\n            columnsMap: columnsMap\n          });\n\n          if (!uniqueValuesRoot.field) {\n            uniqueValuesRoot.field = field;\n            uniqueValuesRoot.values = {};\n          }\n\n          if (!uniqueValuesRoot.values[stringKey]) {\n            uniqueValuesRoot.values[stringKey] = {\n              field: null,\n              values: null\n            };\n          }\n\n          uniqueValuesRoot = uniqueValuesRoot.values[stringKey];\n        });\n      }\n\n      rootBucket = currentBucket;\n    });\n  };\n\n  data.forEach(onItem);\n  return masterBucket;\n};\n\nvar updateBucketSummaries = function updateBucketSummaries(currentBucket, item, _ref7) {\n  var groupSummaryReducer = _ref7.groupSummaryReducer,\n      groupColumnSummaryReducers = _ref7.groupColumnSummaryReducers,\n      columnsMap = _ref7.columnsMap;\n\n  if (groupSummaryReducer) {\n    currentBucket.groupSummary = groupSummaryReducer.reducer(currentBucket.groupSummary, item, item);\n  }\n\n  if (groupColumnSummaryReducers) {\n    currentBucket.groupColumnSummary = Object.keys(groupColumnSummaryReducers).reduce(function (columnSummaries, colId) {\n      var col = columnsMap[colId];\n      var value = col.name ? item[col.name] : item[colId];\n      columnSummaries[colId] = groupColumnSummaryReducers[colId].reducer(columnSummaries[colId], value, item);\n      return columnSummaries;\n    }, currentBucket.groupColumnSummary);\n  }\n};\n\nexports.updateBucketSummaries = updateBucketSummaries;\n\nvar updateBucketPivotSummary = function updateBucketPivotSummary(currentBucket, item, _ref8) {\n  var groupColumnSummaryReducers = _ref8.groupColumnSummaryReducers,\n      pivotColumnSummaryReducers = _ref8.pivotColumnSummaryReducers,\n      groupName = _ref8.groupName,\n      field = _ref8.field,\n      columnsMap = _ref8.columnsMap;\n  groupColumnSummaryReducers = groupColumnSummaryReducers || {};\n  pivotColumnSummaryReducers = pivotColumnSummaryReducers || {};\n\n  if (!currentBucket[groupName]) {\n    currentBucket[groupName] = {\n      array: [],\n      field: field,\n      values: getDefaultGroupSummaryValue(groupColumnSummaryReducers),\n      pivotColumnSummary: getDefaultGroupSummaryValue(pivotColumnSummaryReducers),\n      pivotSummary: null\n    };\n  }\n\n  currentBucket[groupName].array.push(item);\n  currentBucket[groupName].values = Object.keys(groupColumnSummaryReducers).reduce(function (columnSummaries, colId) {\n    var col = columnsMap[colId];\n    var value = col.name ? item[col.name] : item[colId];\n    columnSummaries[colId] = groupColumnSummaryReducers[colId].reducer(columnSummaries[colId], value, item);\n    return columnSummaries;\n  }, currentBucket[groupName].values);\n  currentBucket[groupName].pivotColumnSummary = Object.keys(pivotColumnSummaryReducers).reduce(function (pivotColumnSummaries, colId) {\n    if (pivotColumnSummaryReducers[colId]) {\n      pivotColumnSummaries[colId] = pivotColumnSummaryReducers[colId].reducer(pivotColumnSummaries[colId], groupName, item);\n    }\n\n    return pivotColumnSummaries;\n  }, currentBucket[groupName].pivotColumnSummary);\n  return currentBucket[groupName];\n};\n\nvar getDefaultGroupSummaryValue = function getDefaultGroupSummaryValue(groupColumnSummaryReducers) {\n  return groupColumnSummaryReducers ? Object.keys(groupColumnSummaryReducers).reduce(function (acc, key) {\n    if (groupColumnSummaryReducers[key]) {\n      acc[key] = groupColumnSummaryReducers[key].initialValue;\n    }\n\n    return acc;\n  }, {}) : null;\n};\n\nexports.getDefaultGroupSummaryValue = getDefaultGroupSummaryValue;\nvar _default = groupAndPivot;\nexports.default = _default;"]},"metadata":{},"sourceType":"script"}