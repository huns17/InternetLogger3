/** 
 * Copyright Â© INOVUA TRADING.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _shallowequal = require("../../../packages/shallowequal");

var _default = function _default(fn, gridId, deps) {
  var result = undefined;
  var prevGridId = -1;
  var useWeakMap = !!window.WeakMap;
  var cachePerGrid = useWeakMap ? new WeakMap() : {};
  var grids = {};

  var set = function set(key, value) {
    if (cachePerGrid instanceof WeakMap) {
      if (!grids[key]) {
        grids[key] = {};
      }

      var _key = grids[key];
      cachePerGrid.set(_key, value);
    } else {
      cachePerGrid[key] = value;
    }
  };

  var get = function get(key) {
    if (cachePerGrid instanceof WeakMap) {
      if (!grids[key]) {
        grids[key] = {};
      }

      var _key = grids[key];
      return cachePerGrid.get(_key);
    } else {
      return cachePerGrid[key];
    }
  };

  return function () {
    var gridInfo = get(gridId);
    var depsEqual = false;

    if (gridInfo) {
      var _equalReturnKey = (0, _shallowequal.equalReturnKey)(gridInfo.deps, deps),
          _result = _equalReturnKey.result;

      depsEqual = _result;
    } else {
      gridInfo.value = fn();
    }

    var value = depsEqual ? gridInfo.value : fn();
    set(gridId, {
      deps: deps,
      value: value
    });
    return value;
  };
};

exports.default = _default;